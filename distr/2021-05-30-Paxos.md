---
title: Paxos
updated: 2021-07-03
---

Paxos is a distributed consensus protocol for (deterministic) state machine replication in an asynchronous environment (i.e., there are no bounds on timing) that admits crash failures.

Check out my [reference implementation](https://github.com/keikonakata/rustMisc/tree/master/paxos) in Rust.

### Safety

Paxos guarantees that, for every slot s, replicas ρ1 ρ2, and command c1 c2,
if (s, c1) is in ρ1.decisions and (s, c2) is in ρ2.decisions, then c1 = c2.

This follows from the following property.

A-inv: Suppose for each α among a majority of acceptors, (b, s, c) in α.accepted.
Then, for any b' > b and α', if b' > b and (b', s, c') is in α'.accepted, then c = c'.

This in turn follows from the following property.

C-inv: Suppose that for each α among a majority of acceptors, (b, s, c) in α.accepted.
If b' > b and a commander is spawned for (b', s, c'), then c = c'.

The crux is the proof of C-inv.
It is proved by induction on b'.

Suppose a commander is spawned for (b', s, c').
Hence, a majority of acceptors have adopted b'.

Suppose there is no pvalue in pvals for s. This contradicts with that a majority of acceptors have accepted b.
The condition pval.b >= ballot_num prevents from lower ballot to be accepted once b' is adapted.

Let (b'', s, c'') be the maximum pvalue in pvals. Either b'' = b or by induction hypothesis. Induction hypothesis, because all pvalues in pvals are < b'.

### Termination

Paxos is no exception to the [FLP impossibility result](./2021-04-10-FLP.html), and Paxos does not guarantee termination.
If all leaders but one fail, Paxos is guaranteed to terminate, if we assume that
 messages are eventually delivered, but possibly out of order.

In fact, under fairly weak assumptions about timing, Paxos can be made guaranteed to choose a proposal.
We assume the clock drift of processes and message delivery delay are bounded.
(We don't need to know what those bounds are, but only that such bounds exist.)
when a leader λ discovers (via a preempted message) that there is a higher ballot with leader λ' active, rather than starting a new scout with an even higher ballot number, λ starts monitoring λ' by pinging it on a regular basis.
Only if λ' stops responding, λ selects a higher ballot number and start a scount.
For instance, the value of timeout interval can be chosen with a TCP-like additive increase, multiplicative decrease approach.
If a ballot gets preempted, the value of the timeout interval is multiplied by some small factor larger than 1.
With each chosen proposal, the timeout is decreased linearly.

#### Leader-replica colocation

In practice, each machine that runs a replica also runs a leader.
When this is the case, the replica can send a proposal for a particular slot to its local leader, say λ, rather than broadcasting the request to all leaders.
If λ is passive, monitoring another leader λ', it forwards the proposal to λ'.

#### References

[Paxos Made Moderately Complex (ACM Computing Surveys 2015)](https://dl.acm.org/doi/10.1145/2673577)